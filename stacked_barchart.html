<!DOCTYPE html>
<html>
  <head>
    <title>PageOneX Color Corrupción</title>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.layout.js?1.29.1"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.time.js?1.29.1"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.csv.js?1.29.1"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <style type="text/css">

		svg {
			width: 1500px;
			height: 400px;
			border: solid 1px #ccc;
			font: 10px sans-serif;
			shape-rendering: crispEdges;
		}
		rect:hover {
			cursor:pointer;
			
			opacity: 0.4;
		}

    </style>
  </head>
  <body>
    <script type="text/javascript">
    
//initially based on http://bl.ocks.org/mbostock/1134768
var w = 1500,
    h = 400,
    p = [20, 50, 30, 20],
    x = d3.scale.ordinal().rangeRoundBands([0, w - p[1] - p[3]]), //https://github.com/mbostock/d3/wiki/Ordinal-Scales#ordinal_rangeRoundBands
    y = d3.scale.linear().range([0, h - p[0] - p[2]]),
    color = d3.scale.ordinal().range(["blue", "red", "orange","darkgreen","lime","#FBBBB9","grey"]),
    //parse = d3.time.format("%m-%Y").parse,
    format = d3.time.format("%b");
    //parse = d3.time.format("%Y-%m-%d").parse

var svg = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h)
  .append("svg:g")
    .attr("transform", "translate(" + p[3] + "," + (h - p[2]) + ")");

//Set up stack method
var stack = d3.layout.stack();

//d3.csv("crimea.csv", function(crimea) {
d3.json("data/perMonthLaVanguardia.json", function(total) { //Reads json file

console.log(total);
console.log("total['data']",total);
media = total['media'];
console.log("media",media);
total = total['data'];
for ( var i = 0; i < total.length; i++ ){
	total[i].sort(function(a,b){
		// Turn your strings into dates, and then subtract them
		// to get a value that is either negative, positive, or zero.
		return new Date(a.date) - new Date(b.date);
	});
}
//	console.log("total[0]",total[0]);


//For json
dataset = total;
stack(dataset);
//console.log(dataset);

// Compute the x-domain (by date) and y-domain (by top).
x.domain(	dataset[0].map(function(d) { return d.x; }) ); //coge la primera de las 3 array, podŕia ser 1 o 2 tambien
y.domain([
	0, //valor minimo
	d3.max(
		dataset[dataset.length - 1], function(d) { return d.y0 + d.y; console.log(d.y0 + d.y);} //coge la array ultima que ya tienen todos los valors acumulados
	) //valor maximo
]); //usa la ultima array, la que tiene los valores de las otras ya acumulados para calcular el maximos valos de y

groups = svg.selectAll(".cause").data(dataset);
groups.enter().append("g")
        .attr("class","cause")
        .style("fill",function(d,i) {
            return color(i);
        });
rect = groups.selectAll("rect").data(function(d){return d;});

rect.enter()
  .append("rect")
  //.attr("x",function(d,i) { return i*w/dataset[0].length-20; })
  .attr("x", function(d) { return x(d.x); })
  .attr("y", function(d) { return -y(d.y0) - y(d.y); })
  .attr("width",(w - p[1] - p[3])/(dataset[0].length*1.15))
  .attr("height", function(d) { return y(d.y); })
  .attr("title",function(d) { return d.party + " " + d.y.toPrecision(3) + "\n(" + d.date + ")"; })
  .style("fill-opacity",1);

  // Add a label per date.
  var label = svg.selectAll("text")
      .data(x.domain())
    .enter().append("svg:text")
      .attr("x", function(d) { return x(d) + x.rangeBand() / 2; })
      //.attr("x",function(d,i) { return i*w/dataset[0].length-20; })
      .attr("y", 6)
      .attr("text-anchor", "middle")
      .attr("dy", ".71em")
      //.text(function(d) { return month(d); });
      //.text(format());
      .text("1");

  // Add y-axis rules.
  var rule = svg.selectAll("g.rule")
      .data(y.ticks(5))
    .enter().append("svg:g")
      .attr("class", "rule")
      .attr("transform", function(d) { return "translate(0," + -y(d) + ")"; });

  rule.append("svg:line")
      .attr("x2", w - p[1] - p[3])
      .style("stroke", function(d) { return d ? "#fff" : "#000"; })
      .style("stroke-opacity", function(d) { return d ? .7 : null; });

  rule.append("svg:text")
      .attr("x", w - p[1] - p[3] + 6)
      .attr("dy", ".35em")
      .text(d3.format(",d"));
  
  svg.append("svg:text")
    .attr("x", w  - p[1] - p[3] - 100)
    .attr("y", -h + p[0] + 30)
    .attr("dy", "1em")
    .attr("text-anchor", "right")
    .style("font-size","14px")
    .text(media);
});
    </script>
  </body>
</html>

